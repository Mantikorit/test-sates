<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Space Background</title>
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box;
        }
        
        body { 
            color: #fff; 
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
            background: #000000;
            font-family: Arial, sans-serif;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        
        @keyframes cometFly {
            0% { 
                transform: rotate(-45deg) translateX(-100vw);
                opacity: 0; 
            }
            20% { opacity: 1; }
            80% { opacity: 1; }
            100% { 
                transform: rotate(-45deg) translateX(100vw);
                opacity: 0; 
            }
        }
        
        @media (max-width: 768px) {        
            #spaceBg {
                top: -5% !important;
                left: -5% !important;
                width: 110% !important;
                height: 110% !important;
            }
        }
    </style>
</head>
<body>
    <script>
class StarBackground {
  constructor(config = {}) {
    // Стандартная конфигурация
    this.defaultConfig = {
      starsCount: 400,
      nebulae: [],
      parallax: {
        intensity: 30,
        smoothness: 0.1,
        maxOffset: 50
      },
      colors: {
        primaryGradient: '#1a0a2e',
        secondaryGradient: '#0f0523',
        tertiaryGradient: '#2d0b50',
        bgColor: '#000000'
      },
      stars: {
        minSize: 0.5,
        maxSize: 2.5,
        minOpacity: 0.2,
        maxOpacity: 0.7,
        minDuration: 3,
        maxDuration: 10
      },
      animations: {
        fadeInDuration: 2000,
        starsChangeDuration: 1000
      },
      nebulaeSettings: {
        minCount: 1,
        maxCount: 5,
        minSize: 100,
        maxSize: 400,
        minBlur: 20,
        maxBlur: 100,
        minOpacity: 0.1,
        maxOpacity: 0.5
      },
      // Цветовые схемы для туманностей
      nebulaColorSchemes: [
        {
          name: "Фиолетовая",
          colors: ['#8c2a5d', '#5d2a8c', '#8c5a7a']
        },
        {
          name: "Синяя",
          colors: ['#2a5d8c', '#5a8c8c', '#2a8c5d']
        },
        {
          name: "Теплая",
          colors: ['#8c5d2a', '#5d8c2a', '#8c2a2a']
        }
      ]
    };

    // Цветовые схемы для фона
    this.defaultColorSchemes = [
      {
        name: "Фиолетовая",
        primaryGradient: '#1a0a2e',
        secondaryGradient: '#0f0523',
        tertiaryGradient: '#2d0b50',
        bgColor: '#000000',
        // Связь с несколькими схемами туманностей
        linkedNebulaSchemes: ["Фиолетовая", "Синяя"]
      },
      {
        name: "Голубая",
        primaryGradient: '#0a1a2e',
        secondaryGradient: '#051223',
        tertiaryGradient: '#0b2d50',
        bgColor: '#000011',
        linkedNebulaSchemes: ["Синяя"]
      },
      {
        name: "Красная",
        primaryGradient: '#2e0a0a',
        secondaryGradient: '#230505',
        tertiaryGradient: '#500b0b',
        bgColor: '#110000',
        linkedNebulaSchemes: ["Теплая", "Фиолетовая"]
      },
      {
        name: "Зеленая",
        primaryGradient: '#0a2e1a',
        secondaryGradient: '#052312',
        tertiaryGradient: '#0b502d',
        bgColor: '#001100'
      },
      {
        name: "Золотая",
        primaryGradient: '#2e1a0a',
        secondaryGradient: '#231205',
        tertiaryGradient: '#503d0b',
        bgColor: '#110d00'
      }
    ];

    // Глубокое слияние конфигураций
    this.config = { 
      ...this.defaultConfig,
      ...config,
      nebulaeSettings: {
        ...this.defaultConfig.nebulaeSettings,
        ...(config.nebulaeSettings || {})
      }
    };

    // Пользовательские цветовые схемы
    this.colorSchemes = config.colorSchemes || this.defaultColorSchemes;
    
    // Пользовательские схемы для туманностей
    this.nebulaColorSchemes = config.nebulaColorSchemes || this.defaultConfig.nebulaColorSchemes;
    
    // Цвета туманностей по умолчанию
    this.nebulaColors = [
      '#8c2a5d', '#2a8c5d', '#2a5d8c', '#5d2a8c', 
      '#8c5d2a', '#5d8c2a', '#5a8c8c', '#8c5a7a'
    ];

    // Если цвета не заданы - выбираем случайную схему
    if (!config.colors) {
      this.config.colors = this.getRandomColorScheme();
    }
    
    // Всегда применяем связанные схемы туманностей
    this.applyLinkedNebulaSchemes();

    // Если туманности не заданы - генерируем случайные
    if (!config.nebulae) {
      this.generateRandomNebulae();
    }

    this.init();
  }

  /**
   * Применяет связанные цветовые схемы для туманностей
   * на основе выбранной схемы фона
   */
  applyLinkedNebulaSchemes() {
    // Проверяем, есть ли связи в текущей схеме фона
    if (this.config.colors.linkedNebulaSchemes && 
        Array.isArray(this.config.colors.linkedNebulaSchemes)) {
      
      // Собираем все цвета из всех связанных схем
      const allColors = [];
      
      this.config.colors.linkedNebulaSchemes.forEach(schemeName => {
        // Ищем схему туманностей по имени
        const nebulaScheme = this.nebulaColorSchemes.find(
          scheme => scheme.name === schemeName
        );
        
        // Если нашли и есть цвета - добавляем их
        if (nebulaScheme && nebulaScheme.colors && Array.isArray(nebulaScheme.colors)) {
          allColors.push(...nebulaScheme.colors);
        }
      });
      
      // Если нашли цвета - применяем их
      if (allColors.length > 0) {
        this.nebulaColors = allColors;
      }
    }
  }

  getRandomGradientParams() {
    return {
      radialX: Math.floor(Math.random() * 101),
      radialY: Math.floor(Math.random() * 101),
      linearAngle: Math.floor(Math.random() * 361),
      radialSize: 30 + Math.floor(Math.random() * 41)
    };
  }

  generateBackgroundGradient() {
    const { radialX, radialY, linearAngle, radialSize } = this.getRandomGradientParams();
    
    return `
      radial-gradient(
        circle at ${radialX}% ${radialY}%, 
        ${this.config.colors.primaryGradient} 0%, 
        ${this.config.colors.bgColor} ${radialSize}%
      ),
      linear-gradient(
        ${linearAngle}deg, 
        ${this.config.colors.secondaryGradient} 0%, 
        ${this.config.colors.tertiaryGradient} 100%
      )
    `;
  }

  getRandomColorScheme() {
    return this.colorSchemes[Math.floor(Math.random() * this.colorSchemes.length)];
  }

  generateRandomNebulae() {
    const { minCount, maxCount, minSize, maxSize, minBlur, maxBlur, minOpacity, maxOpacity } = this.config.nebulaeSettings;
    
    // Рассчитываем случайное количество туманностей
    const nebulaCount = Math.floor(Math.random() * (maxCount - minCount + 1)) + minCount;
    this.config.nebulae = [];
    
    for (let i = 0; i < nebulaCount; i++) {
      // Выбираем случайный цвет из текущей палитры туманностей
      const color = this.nebulaColors[Math.floor(Math.random() * this.nebulaColors.length)];
      
      this.config.nebulae.push({
        color,
        size: Math.floor(Math.random() * (maxSize - minSize + 1)) + minSize,
        blur: Math.floor(Math.random() * (maxBlur - minBlur + 1)) + minBlur,
        opacity: minOpacity + Math.random() * (maxOpacity - minOpacity),
        position: {
          top: `${10 + Math.floor(Math.random() * 80)}%`,
          left: `${10 + Math.floor(Math.random() * 80)}%`
        }
      });
    }
  }

  init() {
    this.createContainer();
    this.createNebulae(true);
    this.createStars(true);
    this.initParallax();
    this.addResizeListener();
  }

  createContainer() {
    this.spaceBg = document.createElement('div');
    this.spaceBg.id = 'spaceBg';
    Object.assign(this.spaceBg.style, {
      position: 'fixed',
      top: '-10%',
      left: '-10%',
      width: '120%',
      height: '120%',
      background: this.generateBackgroundGradient(),
      zIndex: '-1',
      overflow: 'hidden',
      willChange: 'transform',
      opacity: '0',
      transition: `opacity ${this.config.animations.fadeInDuration}ms ease-out`
    });

    document.body.prepend(this.spaceBg);

    setTimeout(() => {
      this.spaceBg.style.opacity = '1';
    }, 100);
  }

  createNebulae(fadeIn = false) {
    this.config.nebulae.forEach(nebula => {
      const element = document.createElement('div');
      
      Object.assign(element.style, {
        position: 'absolute',
        borderRadius: '50%',
        filter: `blur(${nebula.blur}px)`,
        opacity: fadeIn ? '0' : nebula.opacity,
        width: `${nebula.size}px`,
        height: `${nebula.size}px`,
        background: `radial-gradient(circle, ${nebula.color}, transparent 70%)`,
        ...nebula.position,
        transition: `opacity ${this.config.animations.fadeInDuration}ms ease-out`
      });

      this.spaceBg.appendChild(element);

      if (fadeIn) {
        setTimeout(() => {
          element.style.opacity = nebula.opacity;
        }, 200);
      }
    });
  }

  createStars(fadeIn = false) {
    const { minSize, maxSize, minOpacity, maxOpacity, minDuration, maxDuration } = this.config.stars;

    for (let i = 0; i < this.config.starsCount; i++) {
      const star = document.createElement('div');
      
      const size = Math.random() * (maxSize - minSize) + minSize;
      const duration = minDuration + Math.random() * (maxDuration - minDuration);
      const opacity = minOpacity + Math.random() * (maxOpacity - minOpacity);

      Object.assign(star.style, {
        position: 'absolute',
        backgroundColor: 'white',
        borderRadius: '50%',
        animation: `twinkle ${duration}s infinite ease-in-out`,
        width: `${size}px`,
        height: `${size}px`,
        left: `${Math.random() * 100}%`,
        top: `${Math.random() * 100}%`,
        opacity: fadeIn ? '0' : opacity,
        transition: `opacity ${this.config.animations.fadeInDuration}ms ease-out`
      });

      this.spaceBg.appendChild(star);

      if (fadeIn) {
        setTimeout(() => {
          star.style.opacity = opacity;
        }, Math.random() * this.config.animations.fadeInDuration);
      }
    }
  }

  initParallax() {
    this.lastX = 0;
    this.lastY = 0;
    this.targetX = 0;
    this.targetY = 0;

    document.addEventListener('mousemove', (e) => {
      const normalizedX = e.clientX / window.innerWidth - 0.5;
      const normalizedY = e.clientY / window.innerHeight - 0.5;
      
      this.targetX = normalizedX * this.config.parallax.intensity;
      this.targetY = normalizedY * this.config.parallax.intensity;
    });

    this.animateParallax();
  }

  animateParallax() {
    this.lastX += (this.targetX - this.lastX) * this.config.parallax.smoothness;
    this.lastY += (this.targetY - this.lastY) * this.config.parallax.smoothness;

    const limitedX = Math.max(
      -this.config.parallax.maxOffset, 
      Math.min(this.config.parallax.maxOffset, this.lastX)
    );
    const limitedY = Math.max(
      -this.config.parallax.maxOffset, 
      Math.min(this.config.parallax.maxOffset, this.lastY)
    );

    this.spaceBg.style.transform = `translate(${limitedX}px, ${limitedY}px)`;
    
    requestAnimationFrame(() => this.animateParallax());
  }

  addResizeListener() {
    window.addEventListener('resize', () => {
      this.spaceBg.style.transform = 'translate(0px, 0px)';
      this.lastX = 0;
      this.lastY = 0;
      this.targetX = 0;
      this.targetY = 0;
    });
  }

  addComet() {
    const comet = document.createElement('div');
    
    Object.assign(comet.style, {
      position: 'absolute',
      width: '120px',
      height: '4px',
      background: 'linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.8) 50%, rgba(255,255,255,0) 100%)',
      transformOrigin: 'left center',
      transform: 'rotate(-45deg)',
      top: `${Math.random() * 100}%`,
      left: `${Math.random() * 100}%`,
      animation: `cometFly ${8 + Math.random() * 15}s infinite linear`,
      opacity: '0',
      transition: 'opacity 1s ease-out'
    });

    this.spaceBg.appendChild(comet);

    setTimeout(() => {
      comet.style.opacity = '1';
    }, 50);
  }
}

// Инициализация после загрузки DOM
document.addEventListener('DOMContentLoaded', () => {
  // Расширенные настройки с множественными связями
  const spaceBg = new StarBackground({
    starsCount: 800,
    parallax: {
      intensity: 40,
      smoothness: 0.08,
      maxOffset: 60
    },
    stars: {
      minSize: 0.3,
      maxSize: 3,
      minOpacity: 0.1,
      maxOpacity: 0.9,
      minDuration: 2,
      maxDuration: 15
    },
    animations: {
      fadeInDuration: 1500,
      starsChangeDuration: 1200
    },
    nebulaeSettings: {
      minCount: 3,
      maxCount: 8,
      minSize: 80,
      maxSize: 500,
      minBlur: 10,
      maxBlur: 120,
      minOpacity: 0.05,
      maxOpacity: 0.6
    },
    // Пользовательские цветовые схемы фона
    colorSchemes: [
      {
        name: "Галактическая",
        primaryGradient: '#0a0a2e',
        secondaryGradient: '#050523',
        tertiaryGradient: '#1b0b50',
        bgColor: '#000011',
        // Связь с несколькими схемами туманностей
        linkedNebulaSchemes: ["Космическая", "Синяя"]
      },
      {
        name: "Пурпурная",
        primaryGradient: '#2e0a1a',
        secondaryGradient: '#230515',
        tertiaryGradient: '#500b2d',
        bgColor: '#0a000a',
        linkedNebulaSchemes: ["Марсианская", "Фиолетовая"]
      }
    ],
    // Пользовательские схемы для туманностей
    nebulaColorSchemes: [
      {
        name: "Космическая",
        colors: ['#6b8cff', '#48dbfb', '#1dd1a1']
      },
      {
        name: "Синяя",
        colors: ['#2a5d8c', '#5a8c8c', '#2a8c5d']
      },
      {
        name: "Марсианская",
        colors: ['#ff6b6b', '#ff9f43', '#f368e0']
      },
      {
        name: "Фиолетовая",
        colors: ['#8c2a5d', '#5d2a8c', '#8c5a7a']
      }
    ]
  });

  // Генерация комет
  [0, 2000, 4000, 6000, 8000].forEach(delay => {
    setTimeout(() => spaceBg.addComet(), delay);
  });
});
    </script>
</body>
</html>
